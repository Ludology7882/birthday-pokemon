<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ç”Ÿæ—¥å¯¶å¯å¤¢æœå°‹å™¨</title>
    <meta property="og:title" content="ç”Ÿæ—¥å¯¶å¯å¤¢æœå°‹å™¨">
    <meta property="og:description" content="å°‹æ‰¾å°ˆå±¬æ–¼ä½ çš„å¯¶å¯å¤¢ä»¥åŠå¯¶å¯å¤¢å°éšŠï¼ï½œMade by æ¯ç„‰éŠç„‰ Ludology">
    
    <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Pok%C3%A9_Ball_icon.svg/1200px-Pok%C3%A9_Ball_icon.svg.png">
    
    <meta property="og:url" content="https://ludology7882.github.io/birthday-pokemon/">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ç”Ÿæ—¥å¯¶å¯å¤¢æœå°‹å™¨">
    <meta name="twitter:description" content="å°‹æ‰¾å°ˆå±¬æ–¼ä½ çš„å¯¶å¯å¤¢ä»¥åŠå¯¶å¯å¤¢å°éšŠï¼">
    <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Pok%C3%A9_Ball_icon.svg/1200px-Pok%C3%A9_Ball_icon.svg.png">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5630334263789758" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            margin: 0;
            color: #333;
            position: relative;
        }
        /* èªè¨€åˆ‡æ›é¸å–®æ”¾ç½®åœ¨å³ä¸Šè§’ */
        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .header-container {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 20px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }
	/* å‰µä½œè€…ç½²åæ¨£å¼ */
        .creator-credit {
            color: #7f8c8d;
            font-size: 15px;
            margin-top: -5px; /* è®“ç½²åç¨å¾®é è¿‘å¤§æ¨™é¡Œä¸€é» */
            margin-bottom: 15px;
            font-weight: 500;
        }
        .creator-credit a {
            color: #e74c3c; /* ä½¿ç”¨è·ŸæŒ‰éˆ•ä¸€æ¨£çš„ç´…è‰²ï¼Œç¶­æŒè¦–è¦ºä¸€è‡´æ€§ */
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }
        .creator-credit a:hover {
            color: #c0392b;
            text-decoration: underline;
        }
        p.privacy-note {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .input-group {
            background-color: white;
            padding: 20px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: inline-flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        select.date-select {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            background-color: white;
            cursor: pointer;
        }
        .date-label {
            font-size: 16px;
            font-weight: bold;
            color: #555;
            margin: 0 5px;
        }
        .search-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            margin-left: 10px;
        }
        .search-btn:hover { background-color: #c0392b; }
        
        /* ç¨ç«‹å‡ºä¾†çš„ç¤¾ç¾¤æŒ‰éˆ•å€å¡Š */
        .social-group {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .social-btn {
            text-decoration: none;
            color: white;
            padding: 10px 20px;
            font-size: 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
        }
        .fb-btn { background-color: #1877F2; }
        .fb-btn:hover { background-color: #166fe5; }
        .yt-btn { background-color: #FF0000; }
        .yt-btn:hover { background-color: #cc0000; }

        .loading {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 20px;
        }
        
        /* å»£å‘Šå€å¡Š */
        .ad-container {
            width: 100%;
            max-width: 900px;
            margin: 10px auto;
            text-align: center;
            min-height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
            overflow: hidden;
        }

        /* å„€è¡¨æ¿èˆ‡å¡ç‰‡æ’ç‰ˆ */
        #dashboard {
            display: none;
            width: 100%;
            max-width: 900px;
            flex-direction: column;
            gap: 25px;
            margin-top: 10px;
        }
        .method-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border-left: 6px solid #ccc;
        }
        .method-1 { border-left-color: #e74c3c; } 
        .method-2 { border-left-color: #3498db; } 
        .method-3 { border-left-color: #f39c12; } 
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .showcase {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .pokemon-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            width: 160px;
            text-align: center;
            transition: transform 0.2s;
        }
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        .pokemon-card img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 5px;
        }
        /* ä¸»èªè¨€èˆ‡å‰¯èªè¨€å‹•æ…‹æ¨£å¼ */
        .pokemon-name {
            font-size: 16px;
            font-weight: bold;
            margin-top: 5px;
            color: #333;
        }
        .pokemon-sub-name {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 3px;
            font-family: 'Arial', sans-serif;
            line-height: 1.2;
        }
        .dex-number {
            color: #888;
            font-size: 13px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px dashed #ddd;
            width: 100%;
        }
		/* æˆªåœ–ä¸‹è¼‰æŒ‰éˆ•èˆ‡å‹•ä½œå€å¡Šæ¨£å¼ */
        .action-area {
            width: 100%;
            display: none; /* é è¨­éš±è—ï¼Œæœå°‹å¾Œæ‰é¡¯ç¤º */
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 40px;
        }
        .download-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 6px 15px rgba(39, 174, 96, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .download-btn:hover {
            background-color: #219653;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.4);
        }
        .download-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
	/* å¾€ä¸‹æ²å‹•æç¤ºå­—æ¢æ¨£å¼èˆ‡å‹•ç•« */
        .scroll-hint {
            background-color: #e8f4fd;
            color: #2980b9;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            text-align: center;
            border: 1px solid #bde0fe;
            margin-bottom: -10px; /* ç¸®å°èˆ‡ä¸‹æ–¹å¡ç‰‡çš„é–“è· */
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }
    </style>
</head>
<body>

    <select id="langSwitcher" class="lang-switcher" onchange="changeLanguage()">
        <option value="zh">ç¹é«”ä¸­æ–‡</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
    </select>

    <div class="header-container">
        <h1 id="ui-title">ç”Ÿæ—¥å¯¶å¯å¤¢æœå°‹å™¨</h1>
	<p class="creator-credit">Made by æ¯ç„‰éŠç„‰ Ludology</p>
        <p id="ui-privacy" class="privacy-note">è¼¸å…¥æ‚¨çš„ç”Ÿæ—¥æœˆä»½èˆ‡æ—¥æœŸï¼</p>
        
        <div class="input-group">
            <select id="monthSelect" class="date-select"></select>
            <span id="ui-month" class="date-label">æœˆ</span>
            
            <select id="daySelect" class="date-select"></select>
            <span id="ui-day" class="date-label">æ—¥</span>
            
            <button id="ui-btn-search" class="search-btn" onclick="searchAllMethods()">æ‰¾åˆ°æˆ‘çš„ç”Ÿæ—¥å¯¶å¯å¤¢</button>
        </div>

        <div class="social-group">
            <a href="https://www.facebook.com/Ludology186?locale=zh_TW" target="_blank" class="social-btn fb-btn" id="ui-btn-fb">è¿½è¹¤ Facebook</a>
            <a href="https://www.youtube.com/@ludology7882" target="_blank" class="social-btn yt-btn" id="ui-btn-yt">è¨‚é–± YouTube</a>
        </div>
        
        <div id="loading" class="loading">è³‡æ–™åº«é€£ç·šä¸­ï¼Œè«‹ç¨å€™...</div>
    </div>

    <div class="ad-container">
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-5630334263789758"
             data-ad-slot="5630334263789758"></ins>
        <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
    </div>

    <div id="dashboard">
	<div id="ui-scroll-hint" class="scroll-hint" data-html2canvas-ignore="true">
            ğŸ‘‡ å¾€ä¸‹æ²å‹•æŸ¥çœ‹å…¨éƒ¨ 3 ç¨®çµæœï¼Œæœ€åº•ä¸‹é‚„å¯ä»¥ã€Œæˆªåœ–åˆ†äº«ã€å–”ï¼
        </div>
        <div class="method-section method-1">
            <div id="ui-m1-title" class="section-title">ç·¨è™Ÿå°ç…§ (æ”¹è‰¯ç‰ˆ)</div>
            <div class="showcase" id="result-m1"></div>
        </div>

        <div class="method-section method-2">
            <div id="ui-m2-title" class="section-title">å…¨åœ‹åœ–é‘‘ç‰ˆ(386)</div>
            <div class="showcase" id="result-m2"></div>
        </div>

        <div class="ad-container" style="margin: 10px 0;" data-html2canvas-ignore="true">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-5630334263789758"
                 data-ad-slot="5630334263789758"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
        </div>

        <div class="method-section method-3">
            <div id="ui-m3-title" class="section-title">ä½ çš„å°ˆå±¬ç”Ÿæ—¥å¯¶å¯å¤¢å°éšŠ</div>
            <div class="showcase" id="result-m3"></div>
        </div>
    	<div style="text-align: center; margin-top: 15px; color: #95a5a6; font-size: 13px; font-weight: bold;">
            ğŸ” æ¸¬æ¸¬ä½ çš„ç”Ÿæ—¥å¯¶å¯å¤¢ï¼šludology7882.github.io/birthday-pokemon
        </div>
    </div> <div id="actionArea" class="action-area">
        <button id="btn-download" class="download-btn" onclick="startDownloadCountdown()">
            ğŸ“¸ ä¸‹è¼‰å°ˆå±¬åœ–é‘‘åˆ†äº«
        </button>
    </div>
	</div>

    <script>
        // ==========================================
        // 0. å¤šåœ‹èªç³»å­—å…¸ (i18n) èˆ‡è‡ªå‹•åµæ¸¬é‚è¼¯
        // ==========================================
        const i18n = {
            zh: {
                title: "ç”Ÿæ—¥å¯¶å¯å¤¢æœå°‹å™¨",
                privacy: "è¼¸å…¥æ‚¨çš„ç”Ÿæ—¥æœˆä»½èˆ‡æ—¥æœŸï¼",
                month: "æœˆ",
                day: "æ—¥",
                btnSearch: "æ‰¾åˆ°æˆ‘çš„ç”Ÿæ—¥å¯¶å¯å¤¢",
                btnFb: "æˆ‘çš„Facebook",
                btnYt: "æˆ‘çš„YouTubeé »é“",
				loadingDb: "è³‡æ–™åº«é€£ç·šä¸­ï¼Œè«‹ç¨å€™...",
                m1Title: "ç·¨è™Ÿå°ç…§ (æ”¹è‰¯ç‰ˆ)",
                m2Title: "å…¨åœ‹åœ–é‘‘ç‰ˆ(386)",
                m3Title: "ä½ çš„å°ˆå±¬ç”Ÿæ—¥å¯¶å¯å¤¢å°éšŠ",
                descMatch: "å°æ‡‰",
                descDayOfYear: "ä¸€å¹´ä¸­çš„ç¬¬",
                descDaySuffix: "å¤©",
                descSquad: "å°éšŠæˆå“¡",
                unknown: "æœªçŸ¥åç¨±",
				btnDownload: "ğŸ“¸ ä¸‹è¼‰å°ˆå±¬åœ–é‘‘åˆ†äº«",
            	btnWait: "â³ åœ–ç‰‡ç”Ÿæˆä¸­... è«‹ç¨å€™",
            	btnProcessing: "ğŸ“¸ æ­£åœ¨æ“·å–ç•«é¢...",
		scrollHint: "ğŸ‘‡ å¾€ä¸‹æ²å‹•æŸ¥çœ‹å…¨éƒ¨ 3 ç¨®çµæœï¼Œæœ€åº•ä¸‹é‚„å¯ä»¥ã€Œæˆªåœ–åˆ†äº«ã€å–”ï¼",
            },
            en: {
                title: "Birthday PokÃ©mon Finder",
                privacy: "Enter your birth month and day!",
                month: "Month",
                day: "Day",
                btnSearch: "Discover My Birthday PokÃ©mon!",
                btnFb: "Follow on Facebook",
                btnYt: "Subscribe on YouTube",
                loadingDb: "Connecting to database...",
                m1Title: "Number Mapping (Enhanced Version)",
                m2Title: "National PokÃ©dex (386 Edition)",
                m3Title: "Your Personal Birthday PokÃ©mon Squad",
                descMatch: "Matches",
                descDayOfYear: "The",
                descDaySuffix: "th day of the year",
                descSquad: "Squad Members",
                unknown: "Unknown",
				btnDownload: "ğŸ“¸ Download Your Squad",
          		btnWait: "â³ Generating... Please wait",
            	btnProcessing: "ğŸ“¸ Capturing...",
		scrollHint: "ğŸ‘‡ Scroll down to see all 3 results and download your squad!",
            },
            ja: {
                title: "èª•ç”Ÿæ—¥ãƒã‚±ãƒ¢ãƒ³æ¤œç´¢ãƒ„ãƒ¼ãƒ«",
                privacy: "èª•ç”Ÿæœˆã¨æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼",
                month: "æœˆ",
                day: "æ—¥",
                btnSearch: "èª•ç”Ÿæ—¥ãƒã‚±ãƒ¢ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ï¼",
                btnFb: "ç§ã®Facebook",
                btnYt: "ç§ã®YouTubeãƒãƒ£ãƒ³ãƒãƒ«",
                loadingDb: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„...",
                m1Title: "ç•ªå·å¯¾å¿œè¡¨ï¼ˆæ”¹è‰¯ç‰ˆï¼‰",
                m2Title: "å…¨å›½å›³é‘‘ï¼ˆ386åŒ¹ç‰ˆï¼‰",
                m3Title: "ã‚ãªãŸå°‚ç”¨ã®èª•ç”Ÿæ—¥ãƒã‚±ãƒ¢ãƒ³ãƒãƒ¼ãƒ ",
                descMatch: "å¯¾å¿œ",
                descDayOfYear: "1å¹´ã®ã†ã¡ç¬¬",
                descDaySuffix: "æ—¥ç›®",
                descSquad: "ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼",
                unknown: "ä¸æ˜",
				btnDownload: "ğŸ“¸ ç”»åƒã‚’ä¿å­˜ã—ã¦ã‚·ã‚§ã‚¢",
            	btnWait: "â³ ç”Ÿæˆä¸­... ãŠå¾…ã¡ãã ã•ã„",
            	btnProcessing: "ğŸ“¸ ã‚­ãƒ£ãƒ—ãƒãƒ£ä¸­...",
		scrollHint: "ğŸ‘‡ ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦3ã¤ã®çµæœã‚’ç¢ºèªã—ã€ç”»åƒã‚’ä¿å­˜ã—ã‚ˆã†ï¼",
            }
        };

        let currentLang = 'zh'; // é è¨­èªè¨€

        // åµæ¸¬ç€è¦½å™¨é è¨­èªè¨€
        function detectBrowserLanguage() {
            const browserLang = navigator.language.toLowerCase();
            if (browserLang.includes('ja')) {
                currentLang = 'ja';
            } else if (!browserLang.includes('zh')) {
                currentLang = 'en'; // éä¸­æ–‡éæ—¥æ–‡ï¼Œä¸€å¾‹åˆ‡æ›è‡³è‹±æ–‡ä»¥é¢å‘å…¨çƒ
            }
            document.getElementById('langSwitcher').value = currentLang;
            updateUIText();
        }

        // æ‰‹å‹•åˆ‡æ›èªè¨€
        function changeLanguage() {
            currentLang = document.getElementById('langSwitcher').value;
            updateUIText();
            // å¦‚æœå·²ç¶“æœå°‹éäº†ï¼Œåˆ‡æ›èªè¨€æ™‚è‡ªå‹•é‡æ–°ç¹ªè£½å¡ç‰‡
            if (document.getElementById('dashboard').style.display === 'flex') {
                searchAllMethods();
            }
        }

        // æ›´æ–°ä»‹é¢æ–‡å­—
        function updateUIText() {
            const t = i18n[currentLang];
            document.getElementById('page-title').textContent = t.title;
            document.getElementById('ui-title').textContent = t.title;
            document.getElementById('ui-privacy').textContent = t.privacy;
            document.getElementById('ui-month').textContent = t.month;
            document.getElementById('ui-day').textContent = t.day;
            document.getElementById('ui-btn-search').textContent = t.btnSearch;
            document.getElementById('ui-btn-fb').textContent = t.btnFb;
            document.getElementById('ui-btn-yt').textContent = t.btnYt;
            document.getElementById('ui-m1-title').textContent = t.m1Title;
            document.getElementById('ui-m2-title').textContent = t.m2Title;
            document.getElementById('ui-m3-title').textContent = t.m3Title;
            
            // å¦‚æœé‚„åœ¨è¼‰å…¥ä¸­ï¼Œä¹Ÿè¦åˆ‡æ›è¼‰å…¥æ–‡å­—
            const loadingEl = document.getElementById('loading');
            if(loadingEl.style.display !== 'none') {
                loadingEl.textContent = t.loadingDb;
            }
			// æ›´æ–°ä¸‹è¼‰æŒ‰éˆ•æ–‡å­—ï¼ˆå¦‚æœå®ƒæ²’æœ‰åœ¨å€’æ•¸è¨ˆæ™‚çš„è©±ï¼‰
            const btnDownload = document.getElementById('btn-download');
            if (btnDownload && !btnDownload.disabled) {
                btnDownload.textContent = t.btnDownload;
            }
		// è®“æç¤ºå­—æ¢è·Ÿè‘—åˆ‡æ›èªè¨€
            const hintEl = document.getElementById('ui-scroll-hint');
            if (hintEl) {
                hintEl.textContent = t.scrollHint;
            }
        }


        // ==========================================
        // 1. åˆå§‹åŒ–ä¸‹æ‹‰é¸å–®é‚è¼¯
        // ==========================================
        const monthSelect = document.getElementById('monthSelect');
        const daySelect = document.getElementById('daySelect');

        for (let i = 1; i <= 12; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i < 10 ? `0${i}` : i;
            monthSelect.appendChild(option);
        }

        function updateDays() {
            const month = parseInt(monthSelect.value);
            let maxDays = 31;
            if (month === 2) maxDays = 29; 
            else if ([4, 6, 9, 11].includes(month)) maxDays = 30;

            const currentDay = parseInt(daySelect.value) || 1;
            daySelect.innerHTML = ''; 
            for (let i = 1; i <= maxDays; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i < 10 ? `0${i}` : i;
                daySelect.appendChild(option);
            }
            daySelect.value = currentDay > maxDays ? maxDays : currentDay;
        }

        monthSelect.addEventListener('change', updateDays);
        updateDays();


        // ==========================================
        // 2. è®€å– Google Sheet è³‡æ–™åº«
        // ==========================================
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-TRaO4Mgmcw6QV5bq_ZCCIRzFHnFUUiG1idE8lm8w41EYM-xSUfkjk3OSnpAsvQ/pub?output=csv';
        const CSV_URL = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(SHEET_URL)}`;
        let pokemonDatabase = {}; 

        async function loadDatabase() {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                const rows = csvText.split(/\r?\n/).slice(1); 
                let loadedCount = 0;
                
                rows.forEach(row => {
                    // è«‹ä¾ç…§ä½ å¯¦éš› Google Sheet çš„æ¬„ä½ä½ç½®ä¿®æ”¹ç´¢å¼• (A=0, B=1, C=2, D=3)
                    const cols = row.split(','); 
                    if (cols.length >= 2) {
                        const id = parseInt(cols[0].trim());
                        if (!isNaN(id)) {
                            pokemonDatabase[id] = {
                                zh: cols[1] ? cols[1].trim() : "---",
                                ja: cols[2] ? cols[2].trim() : "---",
                                en: cols[3] ? cols[3].trim() : "---"
                            };
                            loadedCount++;
                        }
                    }
                });

                if (loadedCount > 0) {
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (error) {
                console.error("è®€å–è¡¨å–®å¤±æ•—ï¼š", error);
                document.getElementById('loading').textContent = "Database Error / è³‡æ–™åº«è®€å–å¤±æ•—";
            }
        }
        
        // åŸ·è¡Œèªè¨€åµæ¸¬èˆ‡è³‡æ–™åº«è¼‰å…¥
        detectBrowserLanguage();
        loadDatabase();


        // ==========================================
        // 3. æ ¸å¿ƒé‚è¼¯èˆ‡å‹•æ…‹å¡ç‰‡ç”Ÿæˆ
        // ==========================================
        function getPokemonCardHTML(dexNumber, description) {
            const fallbackName = i18n[currentLang].unknown;
            const pokeData = pokemonDatabase[dexNumber] || { zh: fallbackName, ja: fallbackName, en: fallbackName };
            const imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${dexNumber}.png`;

            // å‹•æ…‹æ±ºå®šèª°æ˜¯ä¸»èªç³»ï¼Œèª°æ˜¯å‰¯èªç³»
            let primaryName, sub1, sub2;
            if (currentLang === 'en') {
                primaryName = pokeData.en; sub1 = pokeData.ja; sub2 = pokeData.zh;
            } else if (currentLang === 'ja') {
                primaryName = pokeData.ja; sub1 = pokeData.en; sub2 = pokeData.zh;
            } else { // é è¨­ä¸­æ–‡
                primaryName = pokeData.zh; sub1 = pokeData.en; sub2 = pokeData.ja;
            }

            return `
                <div class="pokemon-card">
                    <img src="${imgUrl}" alt="${primaryName}" crossorigin="anonymous" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png'">
                    <div class="pokemon-name">${primaryName}</div>
                    <div class="pokemon-sub-name">${sub1}</div>
                    <div class="pokemon-sub-name">${sub2}</div>
                    <div class="dex-number">#${dexNumber}<br>${description}</div>
                </div>
            `;
        }

        // å‹•æ…‹ç”¢ç”Ÿå°æ‡‰èªè¨€çš„æè¿°æ–‡å­—
        function getDescM1(m, d) {
            const t = i18n[currentLang];
            if (currentLang === 'en') return `${t.descMatch} ${m}/${d}`;
            if (currentLang === 'ja') return `${m}æœˆ${d}æ—¥ã«${t.descMatch}`;
            return `${t.descMatch} ${m}æœˆ${d}æ—¥`;
        }
        function getDescM2(days) {
            const t = i18n[currentLang];
            return `${t.descDayOfYear} ${days} ${t.descDaySuffix}`;
        }

        function getMethod1Dex(m, d) {
            const mmdd = m * 100 + d;
            if (mmdd <= 1025) return mmdd;
            if (m === 10 && d >= 26) return mmdd - 894;
            if (m === 11) return mmdd - 871;
            if (m === 12) return mmdd - 869;
            return 1;
        }

       function getMethod2Dex(m, d) {
            // ä½¿ç”¨æ•¸å­—ç›´æ¥å»ºç«‹æ—¥æœŸï¼Œå®Œå…¨é¿é–‹æ™‚å€è½‰æ›çš„èª¤å·®
            // æ³¨æ„ï¼šJavaScript çš„æœˆä»½æ¯”è¼ƒç‰¹åˆ¥ï¼Œæ˜¯å¾ 0 é–‹å§‹ç®— (0 ä»£è¡¨ 1æœˆ)
            const target = new Date(2024, m - 1, d);
            const start = new Date(2024, 0, 1);
            
            // è¨ˆç®—æ¯«ç§’å·®è½‰æˆå¤©æ•¸ (ä½¿ç”¨ Math.round å››æ¨äº”å…¥æœ€ç‚ºç²¾æº–)
            const diffDays = Math.round(Math.abs(target - start) / 86400000);
            
            return diffDays + 1;
        }

        function searchAllMethods() {
            if (Object.keys(pokemonDatabase).length === 0) {
                alert("Database is loading, please try again in a second!");
                return;
            }

            const month = parseInt(monthSelect.value, 10);
            const day = parseInt(daySelect.value, 10);

            const m1Dex = getMethod1Dex(month, day);
            const m2Dex = getMethod2Dex(month, day);
            const m3Squad = [m2Dex];
            if (m2Dex + 366 <= 1025) m3Squad.push(m2Dex + 366);
            if (m2Dex + 732 <= 1025) m3Squad.push(m2Dex + 732);

            // ä½¿ç”¨å‹•æ…‹ç¿»è­¯çš„æè¿°
            document.getElementById('result-m1').innerHTML = getPokemonCardHTML(m1Dex, getDescM1(month, day));
            document.getElementById('result-m2').innerHTML = getPokemonCardHTML(m2Dex, getDescM2(m2Dex));
            
            const squadDesc = i18n[currentLang].descSquad;
            document.getElementById('result-m3').innerHTML = m3Squad.map(dex => getPokemonCardHTML(dex, squadDesc)).join('');

            document.getElementById('dashboard').style.display = 'flex';
			document.getElementById('actionArea').style.display = 'flex';
        }
		// ==========================================
        // 4. æˆªåœ–ä¸‹è¼‰èˆ‡ 5 ç§’å€’æ•¸é‚è¼¯
        // ==========================================
        function startDownloadCountdown() {
            const btn = document.getElementById('btn-download');
            const t = i18n[currentLang];
            
            // é–å®šæŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
            btn.disabled = true;
            let count = 5; // è¨­å®š 5 ç§’å€’æ•¸
            
            // ç«‹å³é¡¯ç¤ºå€’æ•¸æ–‡å­—
            btn.textContent = `${t.btnWait} ${count}s`;
            
            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    btn.textContent = `${t.btnWait} ${count}s`;
                } else {
                    // å€’æ•¸çµæŸï¼Œé–‹å§‹æˆªåœ–
                    clearInterval(timer);
                    btn.textContent = t.btnProcessing;
                    executeScreenshot();
                }
            }, 1000);
        }

        function executeScreenshot() {
            const dashboard = document.getElementById('dashboard');
            const btn = document.getElementById('btn-download');
            const t = i18n[currentLang];
            const m = document.getElementById('monthSelect').value;
            const d = document.getElementById('daySelect').value;
            
            // å‘¼å« html2canvas é€²è¡Œç•«é¢æ“·å–
            html2canvas(dashboard, {
                useCORS: true,       // å…è¨±è·¨åŸŸæŠ“å–å¯¶å¯å¤¢åœ–ç‰‡
                scale: 2,            // æé«˜æˆªåœ–ç•«è³ª
                backgroundColor: "#f4f7f6" // è¨­å®šèƒŒæ™¯è‰²ï¼Œé¿å…é€æ˜é»‘åº•
            }).then(canvas => {
                // å‰µé€ è™›æ“¬é€£çµè§¸ç™¼ä¸‹è¼‰
                const link = document.createElement('a');
                link.download = `BirthdayPokemon_${m}-${d}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // æ¢å¾©æŒ‰éˆ•åŸæœ¬çš„ç‹€æ…‹
                btn.disabled = false;
                btn.textContent = t.btnDownload;
            }).catch(err => {
                console.error("æˆªåœ–ç™¼ç”ŸéŒ¯èª¤:", err);
                alert("æˆªåœ–ç™¼ç”Ÿæ„å¤–éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
                btn.disabled = false;
                btn.textContent = t.btnDownload;
            });
        }
    </script>
</body>

</html>
